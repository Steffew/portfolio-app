# Build Stage: Build the static site
FROM node:18 AS build
WORKDIR /app

# Install dependencies and build the static site
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

# Serve Stage: Serve the static files with a lightweight server
FROM node:18 AS serve
WORKDIR /app
RUN npm install -g serve

# Copy the static files generated by adapter-static
COPY --from=build /app/build /app/build

# Serve the static files with SPA support
CMD ["serve", "-s", "build", "-l", "3000"]
